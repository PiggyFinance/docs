<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-protocol-algorithm-design">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><title data-rh="true">Protocol Algorithm Design | Document for BOC</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://bankofchain.io/protocol-algorithm-design"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Protocol Algorithm Design | Document for BOC"><meta data-rh="true" name="description" content="BOC provides the USD Stablecoins Farming and ETH Farming."><meta data-rh="true" property="og:description" content="BOC provides the USD Stablecoins Farming and ETH Farming."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://bankofchain.io/protocol-algorithm-design"><link data-rh="true" rel="alternate" href="https://bankofchain.io/protocol-algorithm-design" hreflang="en"><link data-rh="true" rel="alternate" href="https://bankofchain.io/zh/protocol-algorithm-design" hreflang="zh"><link data-rh="true" rel="alternate" href="https://bankofchain.io/es/protocol-algorithm-design" hreflang="es"><link data-rh="true" rel="alternate" href="https://bankofchain.io/protocol-algorithm-design" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.3b9537d1.css">
<link rel="preload" href="/assets/js/runtime~main.7302b0e3.js" as="script">
<link rel="preload" href="/assets/js/main.ee5f941c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo256.png" alt="bank of chain" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo256.png" alt="bank of chain" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">BOC Docs</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><span><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_dNtB"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/protocol-algorithm-design" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li><li><a href="/zh/protocol-algorithm-design" target="_self" rel="noopener noreferrer" class="dropdown__link">‰∏≠Êñá</a></li><li><a href="/es/protocol-algorithm-design" target="_self" rel="noopener noreferrer" class="dropdown__link">Espa√±ol</a></li></ul></div><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Contact Information</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/introduction-to-boc">Introduction to BOC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/protocol-components">Protocol Components</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/protocol-algorithm-design">Protocol Algorithm Design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/user-handbook">User Handbook</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/governance">Governance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/security-risk">Security &amp; Risk</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/development-planning">Development Planning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/appendix">Appendix</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/references">References</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/faqs">Frequently Asked Questions (FAQs)</a></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/">üè†</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">Protocol Algorithm Design</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Protocol Algorithm Design</h1><p>BOC provides the <a href="/Protocol-Algorithm-Design#usd-stablecoins-farming-mechanism">USD Stablecoins Farming</a> and <a href="/Protocol-Algorithm-Design#eth-farming">ETH Farming</a>. </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="usd-stablecoins-farming-mechanism">USD Stablecoins Farming Mechanism<a class="hash-link" href="#usd-stablecoins-farming-mechanism" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="process-description">Process Description<a class="hash-link" href="#process-description" title="Direct link to heading">‚Äã</a></h3><p><img loading="lazy" alt="pic-2" src="/assets/images/pic-2-97bdf6be0899bb4e7584c255c5efb367.png" width="1168" height="902" class="img_E7b_"></p><ol><li><p>‚ÄúDeposit‚Äù - The BOC protocol supports users to <code>deposit</code> the three major stablecoins (USDT, USDC, DAI) in any combination and in any amount, and mint USDi of corresponding value to return to the user.<br>‚ÄúWithdraw‚Äù - Users can <code>withdraw</code> USDi all the three major stablecoins at any time through the BOC protocol. By default, they will be returned according to the proportion of the three major stablecoins in the <a href="/appendix#vaults">Vault</a> at that time, or they can specify a certain currency to be returned.</p></li><li><p>After Vault receives the stablecoin, <code>queryTokenPrice</code> queries the price of the user&#x27;s transfer of the <a href="/appendix#stablecoin">stablecoin</a> through an external oracle. When the price returned by the <a href="/appendix#oracle">oracle</a> is higher than 1 USD, it is calculated at 1 USD, and when it is lower than 1 USD, it is calculated at the price of the oracle.</p></li><li><p>Based on the calculated value, <code>mint/burn</code> will <a href="/appendix#burnmint">mint/burn</a> an equivalent value of USDi.</p></li><li><p>The <a href="/appendix#keeper">Keeper</a> module reaches the trigger condition of <code>doHardWork</code> and triggers <code>doHardWork</code>.</p></li><li><p>Vault calls the aggregate exchange module <code>swapTokenToWants</code>.</p></li><li><p>The aggregated exchange module <code>swapTokens</code> completes the exchange.</p></li><li><p>Vault receives the target currency exchanged by the aggregate exchange module.</p></li><li><p>Vault puts stablecoin <code>deposits</code> into the strategy according to the currency required by the strategy.</p></li><li><p>The <a href="/appendix#strategy">strategy</a> invests stablecoin <code>deposits</code> into third-party protocols.</p></li><li><p>The Keeper module reaches the <code>harvest</code> trigger condition and triggers the <code>harvest</code>.</p></li><li><p>Harvester triggers each strategy to execute <code>harvest</code>.</p></li><li><p>Each strategy executes <code>claimRewards</code> to collect mining.</p></li><li><p>Each strategy transfers mining coins <code>transferRewards</code> to Harvester.</p></li><li><p>Harvester sells miner <code>sellRewards</code> into stablecoins through aggregated exchange.</p></li><li><p>Harvester <code>sendProfitToVault</code> transfers stablecoins into Vault.</p></li><li><p>The Keeper module reaches the <code>rebase</code> trigger condition and triggers the <code>rebase</code>.</p></li><li><p>Vault calls <code>changeTotalSupply</code> to issue additional USDi.</p></li><li><p>Vault collects 20% of the yields, which is transferred to the <code>Treasury</code>.</p></li><li><p>The <a href="/appendix#daos-treasury">treasury</a> will benefit users from using <code>buyback</code> to repurchase the BOC governance token.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="mint--burn-rules">Mint &amp; Burn rules<a class="hash-link" href="#mint--burn-rules" title="Direct link to heading">‚Äã</a></h3><p>Here is a numerical example of minting and burning USDi tokens. </p><p>Let‚Äôs assume that Alice deposits 100 USDT, 100 DAI and 100 USDC. </p><p>According to the BOC mint rule: the transaction price is 1 USD when the price from Chainlink is higher than 1 USD, otherwise the transaction price is equal to the price from Chainlink. </p><p>Thus, Alice will <code>mint</code> 299 USDi in total:</p><p>The current price from Chainlink is:</p><ul><li>1 USDT = 1.01 USD                                                        </li><li>1 DAI = 0.99 USD                                                         </li><li>1 USDC = 1.00 USD</li></ul><p>100 USDT = 100 x 1.00 = 100 USDi (price of Chainlink &gt; 1 USD final price = 1 USD)<br>
<!-- -->100 DAI = 100 x 0.99 = 99 USDi (price of Chainlink &lt; 1 USD final price = Chainlink price)<br>
<!-- -->100 USDC = 100 x 1.00 = 100 USDi (price of Chainlink = 1 USD final price = 1 USD)</p><p><img loading="lazy" alt="mint" src="/assets/images/mint-763368c26d7693e708e5c0ba1d1b8fcd.png" width="1044" height="370" class="img_E7b_"></p><p>Now, Alice decides to <code>burn</code> the USDi to withdraw her stablecoins. She has 299 USDi now and when she burns depending on the proportion of USDT/USDC/DAI of the Vault the burning smart contract will distribute the same proportion the USDi on each stablecoin, in this case when we redeem there is a little less of USDT on the Vault, so the distribution will be 99 of them for USDT, 100 of them for DAI, and the rest 100 for USDC. Assume the current price from Chainlink does not change. </p><p>The rule of burning is opposite to that of minting: the transaction price is 1 USD when the price from Chainlink is less than 1 USD, otherwise the transaction price is equal to the price from Chainlink.</p><p>Therefore, Alice burns 299 USDi to withdraw:</p><p>Chainlink prices:</p><ul><li>1 USDT = 1.01 USD</li><li>1 DAI = 0.99 USD</li><li>1 USDC = 1.01 USD</li></ul><p>100 USDi = 100/1.01 = 99 USDT  (price of Chainlink &gt; 1 USD final price = Chainlink price)<br>
<!-- -->100 USDi = 100/1.00 = 100 DAI  (price of Chainlink &lt; 1 USD final price = 1 USD)<br>
<!-- -->100 USDi = 100/1.00 = 100 USDC  (price of Chainlink = 1 USD final price = 1 USD)</p><p><img loading="lazy" alt="burn" src="/assets/images/burn-ca91ee76c4aeb96c69f00b11db1f16ad.png" width="1091" height="335" class="img_E7b_"></p><p>The number in the chart here is only a numerical example for better understanding the rules of minting and burning in BOC. In the real world the fluctuation of USDi is much smaller, which means users will never encounter the possible lost like this. In fact, the possible lost here will be less than 0.01%. The objective of these rules is to avoid oracles attacks and protect the protocol.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="harvest">Harvest<a class="hash-link" href="#harvest" title="Direct link to heading">‚Äã</a></h3><p>The <code>harvestTrigger</code> is triggered every day to determine whether the <code>harvest</code> condition is met. The two harvest conditions are:</p><ol><li>Maximum time interval is exceeded.</li><li>The harvest rule met:<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mi>r</mi><mi>o</mi><mi>f</mi><mi>i</mi><mi>t</mi><mo>√ó</mo><mn>20</mn><mi mathvariant="normal">%</mi><mo>&gt;</mo><mi>h</mi><mi>a</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>c</mi><mi>o</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Profit \times 20\% &gt; harvest cost</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em"></span><span class="mord">20%</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal">ha</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord mathnormal">cos</span><span class="mord mathnormal">t</span></span></span></span></span></div></li></ol><p>If any of the above conditions are met, user can do <code>harvest</code> work:</p><ol><li>Execute the yield transfer Harvester (for the strategy with yield production and reach the yield selling threshold);</li><li>Report the current asset from the strategy.</li></ol><table><tr><td>Set parameters</td><td>ETH</td><td>BNB Chain</td><td>Polygon</td></tr><tr><td>Scheduled task trigger cycle</td><td>6:00 am every day</td><td>6:00 am every day</td><td>6:00 am every day</td></tr><tr><td>Maximum time interval for triggering strategie ‚Äúharvest‚Äù (if the interval between current ‚Äúharvest‚Äù and last ‚Äúharvest‚Äù is greater than this value, ‚Äúharvest‚Äù must be done) </td><td>2.5 days</td><td>2.5 days</td><td>2.5 days</td></tr><tr><td>The benefit-cost ratio factor X of the trigger strategy ‚Äúharvest‚Äù (‚Äúharvest‚Äù profit&gt;=cost*X, then ‚Äúharvest‚Äù can be done.)</td><td>5</td><td>5</td><td>5</td></tr></table><h3 class="anchor anchorWithStickyNavbar_mojV" id="rebase">Rebase<a class="hash-link" href="#rebase" title="Direct link to heading">‚Äã</a></h3><p>When the total assets of the Vault are greater than the total issuance of USDi, it means that new income has been generated. At this time, the value of USDi compared with the US dollar will be revised, and the number of USDi will be increased, so that the total value of USDi is consistent with the total value of Vault assets, ensuring 1 USDi is anchored at 1USD. At the same time, 20% of the additional USDi will be transferred to the DAO treasury as a management fee.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="fund-allocation">Fund Allocation<a class="hash-link" href="#fund-allocation" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="dohardwork">doHardWork<a class="hash-link" href="#dohardwork" title="Direct link to heading">‚Äã</a></h4><p>The input into the position adjustment of the algorithm are the official <a href="/appendix#annual-yield-apy">APY</a> of the third-party protocol, the gas required for investment of each strategy, the limit of exchange <a href="/appendix#slippage">slippage</a>, and the <a href="/introduction-to-boc#fund-allocation-rules">rules of fund allocation</a>, and the strategy and amount of the funds to be invested are the output.</p><table><tr><td>Set parameters</td><td>ETH</td><td>BNB Chain</td><td>Polygon</td></tr><tr><td>Scheduled Task Trigger Cycle</td><td>7 am every Wed. &amp; Sat.</td><td>7 am every Wed. &amp; Sat.</td><td>7 am every Wed. &amp; Sat.</td></tr><tr><td>Cost-benefit Calculation Period X (If the profit of investment X days &gt;= cost, ‚ÄúdoHardwork‚Äù can be done)</td><td>365 days</td><td>365 days</td><td>365 days</td></tr></table><h4 class="anchor anchorWithStickyNavbar_mojV" id="allocation">Allocation<a class="hash-link" href="#allocation" title="Direct link to heading">‚Äã</a></h4><p>Compared with <code>doHardWork</code>, <code>allocation</code> has done one more step: take out the funds of the low APY strategy, and then use the official APY of the third-party protocols, the gas required for investment of each strategy, the exchange slippage limit, fund allocation rules, the position adjustment algorithm as an input, and the output is the strategy and the amount of the awaiting investment funds.</p><table><thead><tr><th>Set parameters</th><th>ETH</th><th>BNB Chain</th><th>Polygon</th></tr></thead><tbody><tr><td>Pre-adjusted position report trigger timing</td><td>6:50 am every day</td><td>6:50 am every day</td><td>6:50 am every day</td></tr><tr><td>Scheduled task trigger cycle</td><td>7 am every Monday</td><td>7 am every Monday</td><td>7 am every Monday</td></tr><tr><td>Cost-benefit calculation period X (If the profit of rebalancing X days &gt;= cost, ‚Äúallocation‚Äù can be done)</td><td>30 days</td><td>30 days</td><td>30 days</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_mojV" id="fund-allocation-algorithm">Fund allocation Algorithm<a class="hash-link" href="#fund-allocation-algorithm" title="Direct link to heading">‚Äã</a></h4><table><thead><tr><th>Variable</th><th>Meaning</th></tr></thead><tbody><tr><td>&quot;durationDays&quot;</td><td>The cycle of rebalancing needs to ensure that in a cycle after rebalancing, the profit after rebalancing - the profit before rebalancing - the cost of rebalancing &gt; 0</td></tr><tr><td>&quot;yearDays&quot;</td><td>365days</td></tr><tr><td>&quot;asset1&quot;</td><td>The original assets of the strategy</td></tr><tr><td>&quot;apr1&quot;</td><td>The strategy apr before the position adjustment (APY needs to be converted into apr), the current value of the APY of the position adjustment algorithm is the 7-day average of APY calculated outside the strategy chain</td></tr><tr><td>&quot;deltaAsset&quot;</td><td>Assume the capital change value of the strategy rebalancing</td></tr><tr><td>&quot;poolAssets1&quot;</td><td>The TVL of the strategic target investment pool is used as a parameter for the change of apr after the position adjustment</td></tr></tbody></table><p>Profit before position adjustment</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>g</mi><mi>a</mi><mi>i</mi><mi>n</mi><mn>1</mn><mo>=</mo><mfrac><mrow><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mn>1</mn><mo>√ó</mo><mi>a</mi><mi>p</mi><mi>r</mi><mn>1</mn><mo>√ó</mo><mi>d</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>D</mi><mi>a</mi><mi>y</mi><mi>s</mi></mrow><mrow><mi>y</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>D</mi><mi>a</mi><mi>y</mi><mi>s</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">gain1 = \frac{asset1 \times apr1 \times durationDays}{yearDays}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">ain</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">ye</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">rD</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ys</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.02778em">D</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ys</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div><p>Changed earnings</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>g</mi><mi>a</mi><mi>i</mi><mi>n</mi><mn>2</mn><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mn>1</mn><mo>+</mo><mi>d</mi><mi>e</mi><mi>l</mi><mi>t</mi><mi>a</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mo>‚àí</mo><mi>e</mi><mi>x</mi><mi>c</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo stretchy="false">)</mo><mo>√ó</mo><mi>a</mi><mi>p</mi><mi>r</mi><mn>2</mn><mo>√ó</mo><mi>d</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>D</mi><mi>a</mi><mi>y</mi><mi>s</mi></mrow><mrow><mi>y</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>D</mi><mi>a</mi><mi>y</mi><mi>s</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">gain2 = \frac{(asset1+deltaAsset-exchangeLoss)\times apr2 \times durationDays}{yearDays}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">ain</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.3074em;vertical-align:-0.8804em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">ye</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">rD</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ys</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">lt</span><span class="mord mathnormal">a</span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">c</span><span class="mord mathnormal">han</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">L</span><span class="mord mathnormal">oss</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.02778em">D</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ys</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div><p>changed apr</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>a</mi><mi>p</mi><mi>r</mi><mn>2</mn><mo>=</mo><mfrac><mrow><mi>a</mi><mi>p</mi><mi>r</mi><mn>1</mn><mo>√ó</mo><mi>p</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mi>s</mi><mn>1</mn></mrow><mrow><mo stretchy="false">(</mo><mi>p</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mi>s</mi><mn>1</mn><mo>+</mo><mi>d</mi><mi>e</mi><mi>l</mi><mi>t</mi><mi>a</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mo>‚àí</mo><mi>e</mi><mi>x</mi><mi>c</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">apr2 = \frac{apr1 \times poolAssets1}{(poolAssets1+deltaAsset-exchangeLoss)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.3074em;vertical-align:-0.936em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">lt</span><span class="mord mathnormal">a</span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">c</span><span class="mord mathnormal">han</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">L</span><span class="mord mathnormal">oss</span><span class="mclose">)</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mord">1</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div><p>After substituting apr2 in gain2 using the above equation:</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>g</mi><mi>a</mi><mi>i</mi><mi>n</mi><mn>2</mn><mo>=</mo><mfrac><mrow><mi>a</mi><mi>p</mi><mi>r</mi><mn>1</mn><mo>√ó</mo><mi>d</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>D</mi><mi>a</mi><mi>y</mi><mi>s</mi><mi mathvariant="normal">/</mi><mi>y</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>D</mi><mi>a</mi><mi>y</mi><mi>s</mi><mo>√ó</mo><mo stretchy="false">(</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mn>1</mn><mo>+</mo><mi>d</mi><mi>e</mi><mi>l</mi><mi>t</mi><mi>a</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mo stretchy="false">)</mo><mo>√ó</mo><mi>p</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mi>s</mi><mn>1</mn></mrow><mrow><mi>p</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mi>s</mi><mn>1</mn><mo>+</mo><mi>d</mi><mi>e</mi><mi>l</mi><mi>t</mi><mi>a</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mo>‚àí</mo><mi>e</mi><mi>x</mi><mi>c</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">gain2=\frac{apr1 \times durationDays/yearDays \times (asset1+deltaAsset) \times poolAssets1}{poolAssets1+deltaAsset-exchangeLoss}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">ain</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.3074em;vertical-align:-0.8804em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">lt</span><span class="mord mathnormal">a</span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">c</span><span class="mord mathnormal">han</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">L</span><span class="mord mathnormal">oss</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.02778em">D</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ys</span><span class="mord">/</span><span class="mord mathnormal">ye</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">rD</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ys</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">lt</span><span class="mord mathnormal">a</span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mord">1</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div><p>Then the relationship between the changed income of a single strategy and the changed assets is:</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>d</mi><mi>e</mi><mi>l</mi><mi>t</mi><mi>a</mi><mi>G</mi><mi>a</mi><mi>i</mi><mi>n</mi><mo>=</mo><mi>g</mi><mi>a</mi><mi>i</mi><mi>n</mi><mn>2</mn><mo>‚àí</mo><mi>g</mi><mi>a</mi><mi>i</mi><mi>n</mi><mn>1</mn><mo>=</mo><mfrac><mrow><mi>d</mi><mi>e</mi><mi>l</mi><mi>t</mi><mi>a</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mo>√ó</mo><mo stretchy="false">(</mo><mi>p</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mn>1</mn><mo>‚àí</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mn>1</mn><mo stretchy="false">)</mo><mo>√ó</mo><mi>a</mi><mi>p</mi><mi>r</mi><mn>1</mn><mo>√ó</mo><mi>d</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>D</mi><mi>a</mi><mi>y</mi><mi>s</mi></mrow><mrow><mo stretchy="false">(</mo><mi>p</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mn>1</mn><mo>+</mo><mi>d</mi><mi>e</mi><mi>l</mi><mi>t</mi><mi>a</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mo>‚àí</mo><mi>e</mi><mi>x</mi><mi>c</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo stretchy="false">)</mo><mo>√ó</mo><mi>y</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>D</mi><mi>a</mi><mi>y</mi><mi>s</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">deltaGain = gain2-gain1 = \frac{deltaAsset \times (poolAsset1-asset1) \times apr1 \times durationDays}{(poolAsset1+deltaAsset-exchangeLoss) \times yearDays}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">lt</span><span class="mord mathnormal">a</span><span class="mord mathnormal">G</span><span class="mord mathnormal">ain</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">ain</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">ain</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">lt</span><span class="mord mathnormal">a</span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">c</span><span class="mord mathnormal">han</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">L</span><span class="mord mathnormal">oss</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">ye</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">rD</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ys</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">lt</span><span class="mord mathnormal">a</span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.02778em">D</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ys</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div><p>Cost of changing funds for a single strategy</p><table><thead><tr><th>variable name</th><th>Details</th></tr></thead><tbody><tr><td>withdrawFee</td><td>Withdrawal Fund Handling Fee</td></tr><tr><td>lendFee</td><td>Additional capital operation fee</td></tr><tr><td>exchangeLoss</td><td>Exchange currency slippage loss</td></tr><tr><td>harvestFee</td><td>‚Äúharvest‚Äù Funding Fees</td></tr><tr><td>profitChangeFee</td><td>Capital change cost</td></tr><tr><td>withdrawGas</td><td>withdrawGas is the gas consumed by the ‚Äúwithdraw‚Äù operation, which is estimated by pre-testing</td></tr><tr><td>lendGas</td><td>lendGas is the gas consumed by the ‚Äúlend‚Äù operation, which is estimated by pre-testing</td></tr><tr><td>exchangeLossRate</td><td>Redeem Slippage</td></tr></tbody></table><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>f</mi><mi>i</mi><mi>t</mi><mi>C</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mi>F</mi><mi>e</mi><mi>e</mi><mo>=</mo><mi>w</mi><mi>i</mi><mi>t</mi><mi>h</mi><mi>d</mi><mi>r</mi><mi>a</mi><mi>w</mi><mi>F</mi><mi>e</mi><mi>e</mi><mo>+</mo><mi>l</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>F</mi><mi>e</mi><mi>e</mi><mo>+</mo><mi>e</mi><mi>x</mi><mi>c</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>+</mo><mi>h</mi><mi>a</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>F</mi><mi>e</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">profitChangeFee=withdrawFee+lendFee+exchangeLoss+harvestFee</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.07153em">tC</span><span class="mord mathnormal">han</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.13889em">F</span><span class="mord mathnormal">ee</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em"></span><span class="mord mathnormal" style="margin-right:0.02691em">w</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.13889em">wF</span><span class="mord mathnormal">ee</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em"></span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.13889em">F</span><span class="mord mathnormal">ee</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">c</span><span class="mord mathnormal">han</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">L</span><span class="mord mathnormal">oss</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal">ha</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">es</span><span class="mord mathnormal" style="margin-right:0.13889em">tF</span><span class="mord mathnormal">ee</span></span></span></span></span></div><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>w</mi><mi>i</mi><mi>t</mi><mi>h</mi><mi>d</mi><mi>r</mi><mi>a</mi><mi>w</mi><mi>F</mi><mi>e</mi><mi>e</mi><mo>=</mo><mi>g</mi><mi>a</mi><mi>s</mi><mi>P</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>e</mi><mo>√ó</mo><mi>w</mi><mi>i</mi><mi>t</mi><mi>h</mi><mi>d</mi><mi>r</mi><mi>a</mi><mi>w</mi><mi>G</mi><mi>a</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">withdrawFee = gasPrice \times withdrawGas</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal" style="margin-right:0.02691em">w</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.13889em">wF</span><span class="mord mathnormal">ee</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal" style="margin-right:0.02691em">w</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">wG</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span></span></span></span></span></div><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>l</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>F</mi><mi>e</mi><mi>e</mi><mo>=</mo><mi>g</mi><mi>a</mi><mi>s</mi><mi>P</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>e</mi><mo>√ó</mo><mi>l</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>G</mi><mi>a</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">lendFee= gasPrice \times lendGas</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.13889em">F</span><span class="mord mathnormal">ee</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em"></span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">G</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span></span></span></span></span></div><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>e</mi><mi>x</mi><mi>c</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi><mo>=</mo><mi>d</mi><mi>e</mi><mi>l</mi><mi>t</mi><mi>a</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mo>√ó</mo><mi>e</mi><mi>x</mi><mi>c</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mi>L</mi><mi>o</mi><mi>s</mi><mi>s</mi><mi>R</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">exchangeLoss=deltaAsset \times exchangeLossRate</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">c</span><span class="mord mathnormal">han</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">L</span><span class="mord mathnormal">oss</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">lt</span><span class="mord mathnormal">a</span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">c</span><span class="mord mathnormal">han</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">L</span><span class="mord mathnormal">oss</span><span class="mord mathnormal" style="margin-right:0.00773em">R</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span></span></span></span></span></div><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>h</mi><mi>a</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>F</mi><mi>e</mi><mi>e</mi><mo>=</mo><mi>h</mi><mi>a</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>G</mi><mi>a</mi><mi>s</mi><mo>√ó</mo><mi>d</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>D</mi><mi>a</mi><mi>y</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">harvestFee=harvestGas \times durationDays</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord mathnormal">ha</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">es</span><span class="mord mathnormal" style="margin-right:0.13889em">tF</span><span class="mord mathnormal">ee</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em"></span><span class="mord mathnormal">ha</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">es</span><span class="mord mathnormal">tG</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.02778em">D</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ys</span></span></span></span></span></div><p>Find the maximum sum of deltaGain for all strategies:</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>f</mi><mi>i</mi><mi>t</mi><mi>C</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mo>=</mo><mi>M</mi><mi>A</mi><mi>X</mi><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><mo stretchy="false">(</mo><mi>d</mi><mi>e</mi><mi>l</mi><mi>t</mi><mi>a</mi><mi>G</mi><mi>a</mi><mi>i</mi><msub><mi>n</mi><mi>i</mi></msub><mo>‚àí</mo><mi>w</mi><mi>i</mi><mi>t</mi><mi>h</mi><mi>d</mi><mi>r</mi><mi>a</mi><mi>w</mi><mi>F</mi><mi>e</mi><msub><mi>e</mi><mi>i</mi></msub><mo>‚àí</mo><mi>l</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>F</mi><mi>e</mi><msub><mi>e</mi><mi>i</mi></msub><mo>‚àí</mo><mi>e</mi><mi>x</mi><mi>c</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mi>L</mi><mi>o</mi><mi>s</mi><msub><mi>s</mi><mi>i</mi></msub><mo>‚àí</mo><mi>h</mi><mi>a</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>F</mi><mi>e</mi><msub><mi>e</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">profitChange=MAX\sum_{i=1}^m(deltaGain_i -withdrawFee_i-lendFee_i - exchangeLoss_i-harvestFee_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.07153em">tC</span><span class="mord mathnormal">han</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em"></span><span class="mord mathnormal" style="margin-right:0.10903em">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07847em">X</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em"><span style="top:-1.8723em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em"><span class="pstrut" style="height:3.05em"></span><span><span class="mop op-symbol large-op">‚àë</span></span></span><span style="top:-4.3em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">lt</span><span class="mord mathnormal">a</span><span class="mord mathnormal">G</span><span class="mord mathnormal">ai</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.02691em">w</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.13889em">wF</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em"></span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.13889em">F</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">c</span><span class="mord mathnormal">han</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">L</span><span class="mord mathnormal">os</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">ha</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">es</span><span class="mord mathnormal" style="margin-right:0.13889em">tF</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>f</mi><mi>i</mi><mi>t</mi><mi>C</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mo>=</mo><mi>M</mi><mi>A</mi><mi>X</mi><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><mo stretchy="false">(</mo><mfrac><mrow><mi>d</mi><mi>e</mi><mi>l</mi><mi>t</mi><mi>a</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><msub><mi>t</mi><mi>i</mi></msub><mo>√ó</mo><mo stretchy="false">(</mo><mi>p</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><msub><mi>t</mi><mi>i</mi></msub><mo>‚àí</mo><mi>a</mi><mi>s</mi><mi>s</mi><mi>e</mi><msub><mi>t</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>√ó</mo><mi>a</mi><mi>p</mi><msub><mi>r</mi><mi>i</mi></msub><mo>‚àó</mo><mi>d</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>D</mi><mi>a</mi><mi>y</mi><msub><mi>s</mi><mi>i</mi></msub></mrow><mrow><mo stretchy="false">(</mo><mi>p</mi><mi>o</mi><mi>o</mi><mi>l</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><msub><mi>t</mi><mi>i</mi></msub><mo>+</mo><mi>d</mi><mi>e</mi><mi>l</mi><mi>t</mi><mi>a</mi><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><msub><mi>t</mi><mi>i</mi></msub><mo>‚àí</mo><mi>e</mi><mi>x</mi><mi>c</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mi>L</mi><mi>o</mi><mi>s</mi><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>√ó</mo><mi>y</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>D</mi><mi>a</mi><mi>y</mi><msub><mi>s</mi><mi>i</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">profitChange=MAX\sum_{i=1}^m(\frac{deltaAsset_i \times (poolAsset_i-asset_i) \times apr_i * durationDays_i}{(poolAsset_i+deltaAsset_i-exchangeLoss_i) \times yearDays_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.07153em">tC</span><span class="mord mathnormal">han</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em"></span><span class="mord mathnormal" style="margin-right:0.10903em">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07847em">X</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em"><span style="top:-1.8723em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em"><span class="pstrut" style="height:3.05em"></span><span><span class="mop op-symbol large-op">‚àë</span></span></span><span style="top:-4.3em;margin-left:0em"><span class="pstrut" style="height:3.05em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">lt</span><span class="mord mathnormal">a</span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">c</span><span class="mord mathnormal">han</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">L</span><span class="mord mathnormal">os</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">ye</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em">rD</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">lt</span><span class="mord mathnormal">a</span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mord mathnormal">oo</span><span class="mord mathnormal" style="margin-right:0.01968em">l</span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">sse</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àó</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.02778em">D</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></div><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>‚àí</mo><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>F</mi><mi>e</mi><msub><mi>e</mi><mi>i</mi></msub><mo>‚àí</mo><mi>e</mi><mi>x</mi><mi>c</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mi>L</mi><mi>o</mi><mi>s</mi><msub><mi>s</mi><mi>i</mi></msub><mo>‚àí</mo><mi>h</mi><mi>a</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>F</mi><mi>e</mi><msub><mi>e</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">- operateFee_i - exchangeLoss_i - harvestFee_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em"></span><span class="mord">‚àí</span><span class="mord mathnormal">o</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em">er</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.13889em">F</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">c</span><span class="mord mathnormal">han</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">L</span><span class="mord mathnormal">os</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">ha</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="mord mathnormal">es</span><span class="mord mathnormal" style="margin-right:0.13889em">tF</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div><p>Total Change Profit ProfitChange
In this formula, the only variable is the deltaAsset for each strategy. At the same time, the solution needs to be limited by:</p><p>Restrictions</p><ol><li>The same protocol strategy (multiple constraints) funds do not exceed 30% of the total funds.</li><li>The sum of all asset changes in and out is 0.</li></ol><p>Boundary conditions</p><ol><li>Strategic assets cannot exceed 20% of total assets.</li><li>The strategic funds cannot exceed 50% of the target pool assets.</li></ol><p>Use python scipy&#x27;s <code>optimize.minimize</code> to find the current optimal rebalancing scheme.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="public-parameter-configuration">Public Parameter Configuration<a class="hash-link" href="#public-parameter-configuration" title="Direct link to heading">‚Äã</a></h4><table><thead><tr><th>Set parameters</th><th>ETH</th><th>BNB Chain</th><th>Polygon</th></tr></thead><tbody><tr><td>Fund allocation calculation Exchange slippage settings</td><td>0.25%</td><td>0.25%</td><td>0.25%</td></tr><tr><td>Gas configuration (including strategy deposit and withdrawal Gas, exchange Gas, harvest cost)</td><td>Actual Gas</td><td>Actual Gas</td><td>Actual Gas</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_mojV" id="official-apy-calculation-rules">Official APY Calculation Rules<a class="hash-link" href="#official-apy-calculation-rules" title="Direct link to heading">‚Äã</a></h4><p>The official APY are needed as a reference when allocating funds. The sources of official APY are as follows: vfat.tools, coingecko, zapper, Official APY, apy.vision Fee, etc. If the official APY source channel does not include the APY calculation of the protocol strategy, the BOC directly copies the official APY calculation rules of the protocol strategy. Generally speaking, the official APY of the protocol strategy consists of market-making revenue and mining coin revenue. Taking the ‚ÄúConvexLusdStrategy‚Äù strategy that BOC has already docked as an example, its APY consists from the contents of following table:</p><table><tr><td>APY Mark</td><td>APR</td><td>APY</td><td>Compound Interest</td><td>Calculation Method</td><td>Data Source</td></tr><tr><td>Trx Fee</td><td>0.0024</td><td>Tx Fee</td><td>N</td><td>API</td><td>https://www.convexfinance.com/api/curve-apys</td></tr><tr><td>crv</td><td>0.023523458</td><td>cvx mining coins</td><td>Y</td><td>API</td><td>https://www.convexfinance.com/api/curve-apys</td></tr><tr><td>cvx</td><td>0.024132445</td><td>cvx mining coins</td><td>Y</td><td>Contract Calculation</td><td>Issued according to time, one-year mining coin price/total pool assets can get APR</td></tr></table><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mi>P</mi><mi>Y</mi><mo>=</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi>A</mi><mi>P</mi><mi>R</mi><msup><mo stretchy="false">)</mo><mrow><mi>p</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>o</mi><mi>d</mi><mi>s</mi></mrow></msup><mo>‚àí</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">APY=(1+APR)^{periods}-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em">P</span><span class="mord mathnormal" style="margin-right:0.22222em">Y</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.1491em;vertical-align:-0.25em"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.00773em">PR</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em"><span style="top:-3.113em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em">er</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">1</span></span></span></span></span></div><p>The ‚Äúperiods‚Äù parameter is the interest payment period.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="strategy-actual-apy-calculation-rules">Strategy Actual APY Calculation Rules<a class="hash-link" href="#strategy-actual-apy-calculation-rules" title="Direct link to heading">‚Äã</a></h4><p>The actual APY of the strategy is calculated based on the standard return of the strategy currency.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="eth-farming-mechanism">ETH Farming Mechanism<a class="hash-link" href="#eth-farming-mechanism" title="Direct link to heading">‚Äã</a></h2><p>The mechanism of ETH farming is exactly the same as that of the USD stablecoins farming at present. The only difference is that the collateral of USD stablecoins is USDi, thus, that of ETH is called ETHi.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/PiggyFinance/docs/blob/master/i18n/en/docusaurus-plugin-content-docs/current/protocol-algorithm-design.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/protocol-components"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Protocol Components</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/user-handbook"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">User Handbook</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#usd-stablecoins-farming-mechanism" class="table-of-contents__link toc-highlight">USD Stablecoins Farming Mechanism</a><ul><li><a href="#process-description" class="table-of-contents__link toc-highlight">Process Description</a></li><li><a href="#mint--burn-rules" class="table-of-contents__link toc-highlight">Mint &amp; Burn rules</a></li><li><a href="#harvest" class="table-of-contents__link toc-highlight">Harvest</a></li><li><a href="#rebase" class="table-of-contents__link toc-highlight">Rebase</a></li><li><a href="#fund-allocation" class="table-of-contents__link toc-highlight">Fund Allocation</a></li></ul></li><li><a href="#eth-farming-mechanism" class="table-of-contents__link toc-highlight">ETH Farming Mechanism</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 BOC Technical Team all right reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.7302b0e3.js"></script>
<script src="/assets/js/main.ee5f941c.js"></script>
</body>
</html>